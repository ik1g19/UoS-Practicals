<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Transactions and Concurrency Concurrency In a multi-user DBMS, many users may use the system concurrently Stored data items may be accessed concurrently by user programs Transaction↔A logical unit of work that changes the contents of a database Serial vs Serialisable Serial Transactions↔Transactions running one at a time, with no overlap Serialisable Transactions↔Transactions behaving as if they were serial, but may be executed concurrently Transactions should be serialisable Atomicity System failure partway through a transaction may leave the database in an inconsistent state Atomic Transactions↔Operations within the transaction are either all executed successfully or not executed at all Transaction Problems Basic Database Access Operations read(X)→Reads a database item $X_d$ into a program variable $X_T$ in transaction $T$ write(X)→Writes the value of program variable $X_T$ in transaction $T$ into the database item $X_d$ The Lost Update Problem #Db ↓ Two transactions have operations interleaved so that some DB items are incorrect  The Temporary Update (Dirty Read) Problem #Db ↓ One transaction updates a DB item and then fails, item is accessed before reverting to its original value  The Incorrect Summary Problem ↓ One transaction calculates an aggregate summary function on multiple records while other transactions update records Aggregate function may read some values before they are updated, and some after  The Unrepeatable Read Problem #Db ↓ One transaction reads an item twice, while another changes the item between the two reads  Transaction Processing When a transaction is submitted for execution, the system must ensure that ↓ All operations in the transaction are completed successfully, with effect recorded permanently in the database, or There is no effect on the database or other transactions Transactions may be read-only}} or {{update Transaction Life Cycle ↓  ACID ACID Properties Atomicity↔A transaction is either performed completely or not at all #Db Consistency↔Correct transaction execution must take the database from one consistent state to another #Db Isolation↔A transaction should not make updates externally visible (to other transactions) until committed #Db Durability↔Once database is changed and committed, changes should not be lost because of failure #Db Schedules A schedule S of n transactions is an ordering of the operations of the transactions}}, subject to {{the constraint that for each transaction }}{{T}}{{ that participates in }}{{S}}, the operations in T must {{appear in the same order in }}{{S}}{{ that they do in }}{{T Two operations in a schedule are conflicting if ↓ They belong to different transactions and  They access the same data item and At least one of the operations is a write()  Serial and Serialisable  A schedule is serial if ↓  For each transaction T in the schedule, all operations in T are executed consecutively (no interleaving)   A schedule S of n transactions is serialisable if ↓  It is equivalent to some serial schedule of the same n transactions    Schedule Equivalence  Two schedules are result equivalent if they produce the same final state on the database Two schedules are conflict equivalent if the order of any two conflicting operations is the same in both schedules  Non-Serial and Non-Serialisable Schedule     Non-Serial but Serialisable Schedule     Locking Locks are used to synchronise access by concurrent transactions to a database Modes Shared→For reading #Db Exclusive→For writing #Db Lock Operations lock-shared(X)↔Attempt to acquire a shared lock on X lock-exclusive(X)↔Attempt to acquire an exclusive lock on X unlock(X)↔Relinquish all locks on X Lock Outcome #Db ↓  The result of an attempt to obtain a lock is either ↓  Grant lock (able to access the item) Wait for lock to be granted (not yet able to access item) Abort  Locking Rules Must issue **lock-shared(X)**}} or {{lock-exclusive(X) before a read(X) operation Must issue lock-exclusive(X) before a write(X) operation Must issue unlock(X) after all **read(X)**}} and {{write(X) operations are completed Cannot issue lock-shared(X) if already holding a lock on }}{{X Cannot issue lock-exclusive(X) if already holding a lock on }}{{X Cannot issue unlock(X) unless holding a lock on }}{{X Lock Conversion Rules may be relaxed in order to allow lock conversion  A lock-shared(X) may be upgraded to a }}{{lock-exclusive(X) A lock-exclusive(X) may be downgraded to a }}{{lock-shared(X)  Locking, by itself, isn&rsquo;t enough for non-serial schedules Two-Phase Locking (2PL) Extra rules for handling locks ↓ All locking operations precede the first unlock operation in a transaction Locks are only released after a transaction commits or aborts Two Phases Guarantees serializable transactions Growing Phase #Db ↓  Obtain locks Access data items  Shrinking Phase #Db ↓  Release locks  Deadlock #Db ↓ When two or more transactions are waiting for each other to release a lock on an item  Conditions for deadlock to occur ↓ Concurrency→Two processes claim exclusive control of one resource Hold→One process continues to hold exclusively controlled resources until its need is satisfied Wait→Processes wait in queues for additional resources while holding resources already allocated Mutual dependency Dealing with Deadlock Deadlock Prevention ↓  Every transaction locks all items it needs in advance, if an item cannot be obtained , no items are locked Transactions updating the same resources are not allowed to execute concurrently  Deadlock Detection  Wait-for graph    Representation of interactions between transactions #Db Directed graph containing ↓  A vertex for each transaction that is currently executing An edge from T1 to T2 if T1 is waiting to lock an item that is currently locked by T2   Deadlock exists iff the Wait-For Graph contains a cycle #Db     Timeouts ↓  If a transaction waits for a resource for longer than a given period (the timeout), the system assumes that the transaction is deadlocked and aborts it    Granularity and Concurrency Coarser granularity gives lower degree of concurrency Finer granularity gives higher overhead Timestamps ↓ Alternative to locks Timestamps are unique identifiers for transactions TS(T)→Transaction start time Each resource X has ↓ A read timestamp ([read-TS(X)](Advanced Databases/Week 6/Transactions and Concurrency/Timestamps/Each resource X has/A read timestamp (read-TS(X))/read-TS(X)."><meta property="og:title" content="Week 6"><meta property="og:description" content="Transactions and Concurrency Concurrency In a multi-user DBMS, many users may use the system concurrently Stored data items may be accessed concurrently by user programs Transaction↔A logical unit of work that changes the contents of a database Serial vs Serialisable Serial Transactions↔Transactions running one at a time, with no overlap Serialisable Transactions↔Transactions behaving as if they were serial, but may be executed concurrently Transactions should be serialisable Atomicity System failure partway through a transaction may leave the database in an inconsistent state Atomic Transactions↔Operations within the transaction are either all executed successfully or not executed at all Transaction Problems Basic Database Access Operations read(X)→Reads a database item $X_d$ into a program variable $X_T$ in transaction $T$ write(X)→Writes the value of program variable $X_T$ in transaction $T$ into the database item $X_d$ The Lost Update Problem #Db ↓ Two transactions have operations interleaved so that some DB items are incorrect  The Temporary Update (Dirty Read) Problem #Db ↓ One transaction updates a DB item and then fails, item is accessed before reverting to its original value  The Incorrect Summary Problem ↓ One transaction calculates an aggregate summary function on multiple records while other transactions update records Aggregate function may read some values before they are updated, and some after  The Unrepeatable Read Problem #Db ↓ One transaction reads an item twice, while another changes the item between the two reads  Transaction Processing When a transaction is submitted for execution, the system must ensure that ↓ All operations in the transaction are completed successfully, with effect recorded permanently in the database, or There is no effect on the database or other transactions Transactions may be read-only}} or {{update Transaction Life Cycle ↓  ACID ACID Properties Atomicity↔A transaction is either performed completely or not at all #Db Consistency↔Correct transaction execution must take the database from one consistent state to another #Db Isolation↔A transaction should not make updates externally visible (to other transactions) until committed #Db Durability↔Once database is changed and committed, changes should not be lost because of failure #Db Schedules A schedule S of n transactions is an ordering of the operations of the transactions}}, subject to {{the constraint that for each transaction }}{{T}}{{ that participates in }}{{S}}, the operations in T must {{appear in the same order in }}{{S}}{{ that they do in }}{{T Two operations in a schedule are conflicting if ↓ They belong to different transactions and  They access the same data item and At least one of the operations is a write()  Serial and Serialisable  A schedule is serial if ↓  For each transaction T in the schedule, all operations in T are executed consecutively (no interleaving)   A schedule S of n transactions is serialisable if ↓  It is equivalent to some serial schedule of the same n transactions    Schedule Equivalence  Two schedules are result equivalent if they produce the same final state on the database Two schedules are conflict equivalent if the order of any two conflicting operations is the same in both schedules  Non-Serial and Non-Serialisable Schedule     Non-Serial but Serialisable Schedule     Locking Locks are used to synchronise access by concurrent transactions to a database Modes Shared→For reading #Db Exclusive→For writing #Db Lock Operations lock-shared(X)↔Attempt to acquire a shared lock on X lock-exclusive(X)↔Attempt to acquire an exclusive lock on X unlock(X)↔Relinquish all locks on X Lock Outcome #Db ↓  The result of an attempt to obtain a lock is either ↓  Grant lock (able to access the item) Wait for lock to be granted (not yet able to access item) Abort  Locking Rules Must issue **lock-shared(X)**}} or {{lock-exclusive(X) before a read(X) operation Must issue lock-exclusive(X) before a write(X) operation Must issue unlock(X) after all **read(X)**}} and {{write(X) operations are completed Cannot issue lock-shared(X) if already holding a lock on }}{{X Cannot issue lock-exclusive(X) if already holding a lock on }}{{X Cannot issue unlock(X) unless holding a lock on }}{{X Lock Conversion Rules may be relaxed in order to allow lock conversion  A lock-shared(X) may be upgraded to a }}{{lock-exclusive(X) A lock-exclusive(X) may be downgraded to a }}{{lock-shared(X)  Locking, by itself, isn&rsquo;t enough for non-serial schedules Two-Phase Locking (2PL) Extra rules for handling locks ↓ All locking operations precede the first unlock operation in a transaction Locks are only released after a transaction commits or aborts Two Phases Guarantees serializable transactions Growing Phase #Db ↓  Obtain locks Access data items  Shrinking Phase #Db ↓  Release locks  Deadlock #Db ↓ When two or more transactions are waiting for each other to release a lock on an item  Conditions for deadlock to occur ↓ Concurrency→Two processes claim exclusive control of one resource Hold→One process continues to hold exclusively controlled resources until its need is satisfied Wait→Processes wait in queues for additional resources while holding resources already allocated Mutual dependency Dealing with Deadlock Deadlock Prevention ↓  Every transaction locks all items it needs in advance, if an item cannot be obtained , no items are locked Transactions updating the same resources are not allowed to execute concurrently  Deadlock Detection  Wait-for graph    Representation of interactions between transactions #Db Directed graph containing ↓  A vertex for each transaction that is currently executing An edge from T1 to T2 if T1 is waiting to lock an item that is currently locked by T2   Deadlock exists iff the Wait-For Graph contains a cycle #Db     Timeouts ↓  If a transaction waits for a resource for longer than a given period (the timeout), the system assumes that the transaction is deadlocked and aborts it    Granularity and Concurrency Coarser granularity gives lower degree of concurrency Finer granularity gives higher overhead Timestamps ↓ Alternative to locks Timestamps are unique identifiers for transactions TS(T)→Transaction start time Each resource X has ↓ A read timestamp ([read-TS(X)](Advanced Databases/Week 6/Transactions and Concurrency/Timestamps/Each resource X has/A read timestamp (read-TS(X))/read-TS(X)."><meta property="og:type" content="website"><meta property="og:image" content="https://ik1g19.github.io/UoS-Notes/icon.png"><meta property="og:url" content="https://ik1g19.github.io/UoS-Notes/notes/Advanced-Databases/Week-6/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Week 6"><meta name=twitter:description content="Transactions and Concurrency Concurrency In a multi-user DBMS, many users may use the system concurrently Stored data items may be accessed concurrently by user programs Transaction↔A logical unit of work that changes the contents of a database Serial vs Serialisable Serial Transactions↔Transactions running one at a time, with no overlap Serialisable Transactions↔Transactions behaving as if they were serial, but may be executed concurrently Transactions should be serialisable Atomicity System failure partway through a transaction may leave the database in an inconsistent state Atomic Transactions↔Operations within the transaction are either all executed successfully or not executed at all Transaction Problems Basic Database Access Operations read(X)→Reads a database item $X_d$ into a program variable $X_T$ in transaction $T$ write(X)→Writes the value of program variable $X_T$ in transaction $T$ into the database item $X_d$ The Lost Update Problem #Db ↓ Two transactions have operations interleaved so that some DB items are incorrect  The Temporary Update (Dirty Read) Problem #Db ↓ One transaction updates a DB item and then fails, item is accessed before reverting to its original value  The Incorrect Summary Problem ↓ One transaction calculates an aggregate summary function on multiple records while other transactions update records Aggregate function may read some values before they are updated, and some after  The Unrepeatable Read Problem #Db ↓ One transaction reads an item twice, while another changes the item between the two reads  Transaction Processing When a transaction is submitted for execution, the system must ensure that ↓ All operations in the transaction are completed successfully, with effect recorded permanently in the database, or There is no effect on the database or other transactions Transactions may be read-only}} or {{update Transaction Life Cycle ↓  ACID ACID Properties Atomicity↔A transaction is either performed completely or not at all #Db Consistency↔Correct transaction execution must take the database from one consistent state to another #Db Isolation↔A transaction should not make updates externally visible (to other transactions) until committed #Db Durability↔Once database is changed and committed, changes should not be lost because of failure #Db Schedules A schedule S of n transactions is an ordering of the operations of the transactions}}, subject to {{the constraint that for each transaction }}{{T}}{{ that participates in }}{{S}}, the operations in T must {{appear in the same order in }}{{S}}{{ that they do in }}{{T Two operations in a schedule are conflicting if ↓ They belong to different transactions and  They access the same data item and At least one of the operations is a write()  Serial and Serialisable  A schedule is serial if ↓  For each transaction T in the schedule, all operations in T are executed consecutively (no interleaving)   A schedule S of n transactions is serialisable if ↓  It is equivalent to some serial schedule of the same n transactions    Schedule Equivalence  Two schedules are result equivalent if they produce the same final state on the database Two schedules are conflict equivalent if the order of any two conflicting operations is the same in both schedules  Non-Serial and Non-Serialisable Schedule     Non-Serial but Serialisable Schedule     Locking Locks are used to synchronise access by concurrent transactions to a database Modes Shared→For reading #Db Exclusive→For writing #Db Lock Operations lock-shared(X)↔Attempt to acquire a shared lock on X lock-exclusive(X)↔Attempt to acquire an exclusive lock on X unlock(X)↔Relinquish all locks on X Lock Outcome #Db ↓  The result of an attempt to obtain a lock is either ↓  Grant lock (able to access the item) Wait for lock to be granted (not yet able to access item) Abort  Locking Rules Must issue **lock-shared(X)**}} or {{lock-exclusive(X) before a read(X) operation Must issue lock-exclusive(X) before a write(X) operation Must issue unlock(X) after all **read(X)**}} and {{write(X) operations are completed Cannot issue lock-shared(X) if already holding a lock on }}{{X Cannot issue lock-exclusive(X) if already holding a lock on }}{{X Cannot issue unlock(X) unless holding a lock on }}{{X Lock Conversion Rules may be relaxed in order to allow lock conversion  A lock-shared(X) may be upgraded to a }}{{lock-exclusive(X) A lock-exclusive(X) may be downgraded to a }}{{lock-shared(X)  Locking, by itself, isn&rsquo;t enough for non-serial schedules Two-Phase Locking (2PL) Extra rules for handling locks ↓ All locking operations precede the first unlock operation in a transaction Locks are only released after a transaction commits or aborts Two Phases Guarantees serializable transactions Growing Phase #Db ↓  Obtain locks Access data items  Shrinking Phase #Db ↓  Release locks  Deadlock #Db ↓ When two or more transactions are waiting for each other to release a lock on an item  Conditions for deadlock to occur ↓ Concurrency→Two processes claim exclusive control of one resource Hold→One process continues to hold exclusively controlled resources until its need is satisfied Wait→Processes wait in queues for additional resources while holding resources already allocated Mutual dependency Dealing with Deadlock Deadlock Prevention ↓  Every transaction locks all items it needs in advance, if an item cannot be obtained , no items are locked Transactions updating the same resources are not allowed to execute concurrently  Deadlock Detection  Wait-for graph    Representation of interactions between transactions #Db Directed graph containing ↓  A vertex for each transaction that is currently executing An edge from T1 to T2 if T1 is waiting to lock an item that is currently locked by T2   Deadlock exists iff the Wait-For Graph contains a cycle #Db     Timeouts ↓  If a transaction waits for a resource for longer than a given period (the timeout), the system assumes that the transaction is deadlocked and aborts it    Granularity and Concurrency Coarser granularity gives lower degree of concurrency Finer granularity gives higher overhead Timestamps ↓ Alternative to locks Timestamps are unique identifiers for transactions TS(T)→Transaction start time Each resource X has ↓ A read timestamp ([read-TS(X)](Advanced Databases/Week 6/Transactions and Concurrency/Timestamps/Each resource X has/A read timestamp (read-TS(X))/read-TS(X)."><meta name=twitter:image content="https://ik1g19.github.io/UoS-Notes/icon.png"><meta name=twitter:site content="_jzhao"><title>Week 6</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://ik1g19.github.io/UoS-Notes//icon.png><link href=https://ik1g19.github.io/UoS-Notes/styles.80333fa2099c0bee674efa435fde378c.min.css rel=stylesheet><link href=https://ik1g19.github.io/UoS-Notes/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://ik1g19.github.io/UoS-Notes/js/darkmode.fdbb50a651b073e7d85910aebde4469d.min.js></script>
<script src=https://ik1g19.github.io/UoS-Notes/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script async src=https://ik1g19.github.io/UoS-Notes/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://ik1g19.github.io/UoS-Notes/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://ik1g19.github.io/UoS-Notes/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://ik1g19.github.io/UoS-Notes/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://ik1g19.github.io/UoS-Notes/",fetchData=Promise.all([fetch("https://ik1g19.github.io/UoS-Notes/indices/linkIndex.4cd7744b37da745103d2e306cd2cd001.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://ik1g19.github.io/UoS-Notes/indices/contentIndex.a1e306a3e6a8cedcc8275a04564ca752.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://ik1g19.github.io/UoS-Notes",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://ik1g19.github.io/UoS-Notes",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/ik1g19.github.io\/UoS-Notes\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=ik1g19.github.io/UoS-Notes src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://ik1g19.github.io/UoS-Notes/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://ik1g19.github.io/UoS-Notes/>My UoS Notes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Week 6</h1><p class=meta>Last updated
Apr 11, 2023
<a href=https://github.com/ik1g19/notes/Advanced%20Databases/Week%206.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#concurrency>Concurrency</a><ol><li><a href=#in-a-multi-user-dbms-many-users-may-use-the-system-concurrently>In a multi-user DBMS, many users may use the system concurrently</a></li><li><a href=#stored-data-items-may-be-accessed-concurrently-by-user-programs>Stored data items may be accessed concurrently by user programs</a></li><li><a href=#transactiona-logical-unit-of-work-that-changes-the-contents-of-a-database>Transaction↔A logical unit of work that changes the contents of a database</a></li></ol></li><li><a href=#serial-vs-serialisable>Serial vs Serialisable</a><ol><li><a href=#serial-transactionstransactions-running-one-at-a-time-with-no-overlap>Serial Transactions↔Transactions running one at a time, with no overlap</a></li><li><a href=#serialisable-transactionstransactions-behaving-as-if-they-were-serial-but-may-be-executed-concurrently>Serialisable Transactions↔Transactions behaving as if they were serial, but may be executed concurrently</a></li><li><a href=#transactions-should-be-serialisable>Transactions should be <strong>serialisable</strong></a></li></ol></li><li><a href=#atomicity>Atomicity</a><ol><li><a href=#system-failure-partway-through-a-transaction-may-leave-the-database-in-an-inconsistent-state>System failure partway through a transaction may leave the database in an inconsistent state</a></li><li><a href=#atomic-transactionsoperations-within-the-transaction-are-either-all-executed-successfully-or-not-executed-at-all>Atomic Transactions↔Operations within the transaction are either all executed successfully or not executed at all</a></li></ol></li><li><a href=#transaction-problems>Transaction Problems</a><ol><li><a href=#basic-database-access-operations>Basic Database Access Operations</a></li><li><a href=#the-lost-update-problem--db->The Lost Update Problem #Db ↓</a></li><li><a href=#the-temporary-update-dirty-read-problem--db->The Temporary Update (Dirty Read) Problem #Db ↓</a></li><li><a href=#the-incorrect-summary-problem->The Incorrect Summary Problem ↓</a></li><li><a href=#the-unrepeatable-read-problem--db->The Unrepeatable Read Problem #Db ↓</a></li></ol></li><li><a href=#transaction-processing>Transaction Processing</a><ol><li><a href=#when-a-transaction-is-submitted-for-execution-the-system-must-ensure-that->When a transaction is submitted for execution, the system must ensure that ↓</a></li><li><a href=#transactions-may-be-read-only-or-update>Transactions may be <strong>read-only}} or {{update</strong></a></li></ol></li><li><a href=#transaction-life-cycle->Transaction Life Cycle ↓</a><ol><li><a href=#400httpsremnote-user-datas3amazonawscommbsoi0e1bmu1ppnyj9kz8221n6ydydassjboz9zznj70wzhfz6lrnsycsmwgrdc3q_t9jjurgl9s0fxuex-nxg0yms1v2x5b4oo0gtkktgdi_lamsrvutbc1plqffemlpng><img src=https://remnote-user-data.s3.amazonaws.com/mBsOI0E1BMu1PPnYJ9kz8221N6ydydaSSJBOZ9zZnj70WzHFZ6LRnsyCSmWgRdc3Q_t9JJurGL9s0fXUeX-nxG0YmS1V2x5B4oO0gTKktgdi_LamsrVUTBc1PlQfFeml.png alt=|400></a></li></ol></li><li><a href=#acid>ACID</a><ol><li><a href=#acid-properties>ACID Properties</a></li><li><a href=#schedules>Schedules</a></li></ol></li><li><a href=#locking>Locking</a><ol><li><a href=#locks-are-used-to-synchronise-access-by-concurrent-transactions-to-a-database>Locks are used to synchronise access by concurrent transactions to a database</a></li><li><a href=#modes>Modes</a></li><li><a href=#lock-operations>Lock Operations</a></li><li><a href=#lock-outcome--db->Lock Outcome #Db ↓</a></li><li><a href=#locking-rules>Locking Rules</a></li><li><a href=#lock-conversion>Lock Conversion</a></li><li><a href=#locking-by-itself-isnt-enough-for-non-serial-schedules>Locking, by itself, isn&rsquo;t enough for <strong>non-serial</strong> schedules</a></li></ol></li><li><a href=#two-phase-locking-2pl>Two-Phase Locking (2PL)</a><ol><li><a href=#extra-rules-for-handling-locks->Extra rules for handling locks ↓</a></li><li><a href=#two-phases>Two Phases</a></li></ol></li><li><a href=#deadlock--db->Deadlock #Db ↓</a><ol><li><a href=#when-two-or-more-transactions-are-waiting-for-each-other-to-release-a-lock-on-an-item>When two or more transactions are waiting for each other to release a lock on an item</a></li><li><a href=#400httpsremnote-user-datas3amazonawscomfbcai_ui6nbuxko5jekgfd8cm0mufwlio5zcz2zrqfq8uxsdwbe8bfa8lqds3gwg16xbf2lcx7vnsdsvgauzfuugmgxrdlbfae2wiauspxbbfi4bxk9p2logy9tkjfggpng><img src=https://remnote-user-data.s3.amazonaws.com/FBCAi_uI6NbuXKo5JekgFD8cM0muFwLiO5Zcz2ZRQFQ8UxSDwBe8BFa8LQDS3gWg16xBF2lCx7vNsdsVgAuzFuUGmgxRdLbfAE2wIAuspXbbFi4Bxk9P2lOgY9tkjFgG.png alt=|400></a></li><li><a href=#conditions-for-deadlock-to-occur->Conditions for deadlock to occur ↓</a></li><li><a href=#dealing-with-deadlock>Dealing with Deadlock</a></li></ol></li><li><a href=#granularity-and-concurrency>Granularity and Concurrency</a><ol><li><a href=#coarser-granularity-gives-lower-degree-of-concurrency>Coarser granularity gives <strong>lower</strong> degree of concurrency</a></li><li><a href=#finer-granularity-gives-higher-overhead>Finer granularity gives <strong>higher</strong> overhead</a></li></ol></li><li><a href=#timestamps->Timestamps ↓</a><ol><li><a href=#alternative-to-locks>Alternative to locks</a></li><li><a href=#timestamps-are-unique-identifiers-for-transactions>Timestamps are <strong>unique identifiers for transactions</strong></a></li><li><a href=#tsttransaction-start-time>TS(T)→Transaction start time</a></li><li><a href=#each-resource-x-has->Each resource <strong>X</strong> has ↓</a></li><li><a href=#timestamp-ordering>Timestamp Ordering</a></li><li><a href=#basic-timestamp-ordering->Basic Timestamp Ordering ↓</a></li><li><a href=#thomas-write-rule->Thomas&rsquo; Write Rule ↓</a></li><li><a href=#timestamp-ordering-1>Timestamp Ordering</a></li></ol></li><li><a href=#advanced-transactions>Advanced Transactions</a><ol><li><a href=#flat-transactions->Flat Transactions ↓</a></li><li><a href=#long-duration-transactions->Long Duration Transactions ↓</a></li><li><a href=#savepoints->Savepoints ↓</a></li><li><a href=#chained-transactions->Chained Transactions ↓</a></li><li><a href=#savepoints-vs-chained-transactions>Savepoints vs Chained Transactions</a></li><li><a href=#nested-transactions->Nested Transactions ↓</a></li><li><a href=#emulating-nesting-with-savepoints>Emulating Nesting with Savepoints</a></li><li><a href=#sagas->Sagas ↓</a></li></ol></li></ol><ol><li><ol><li></li><li><a href=#redo-logging>Redo Logging</a></li><li><a href=#undoredo-logging>Undo/Redo Logging</a></li></ol></li></ol></nav></details></aside><a href=#transactions-and-concurrency><h1 id=transactions-and-concurrency><span class=hanchor arialabel=Anchor># </span>Transactions and Concurrency</h1></a><a href=#concurrency><h2 id=concurrency><span class=hanchor arialabel=Anchor># </span>Concurrency</h2></a><a href=#in-a-multi-user-dbms-many-users-may-use-the-system-concurrently><h3 id=in-a-multi-user-dbms-many-users-may-use-the-system-concurrently><span class=hanchor arialabel=Anchor># </span>In a multi-user DBMS, many users may use the system concurrently</h3></a><a href=#stored-data-items-may-be-accessed-concurrently-by-user-programs><h3 id=stored-data-items-may-be-accessed-concurrently-by-user-programs><span class=hanchor arialabel=Anchor># </span>Stored data items may be accessed concurrently by user programs</h3></a><a href=#transactiona-logical-unit-of-work-that-changes-the-contents-of-a-database><h3 id=transactiona-logical-unit-of-work-that-changes-the-contents-of-a-database><span class=hanchor arialabel=Anchor># </span>Transaction↔A logical unit of work that changes the contents of a database</h3></a><a href=#serial-vs-serialisable><h2 id=serial-vs-serialisable><span class=hanchor arialabel=Anchor># </span>Serial vs Serialisable</h2></a><a href=#serial-transactionstransactions-running-one-at-a-time-with-no-overlap><h3 id=serial-transactionstransactions-running-one-at-a-time-with-no-overlap><span class=hanchor arialabel=Anchor># </span>Serial Transactions↔Transactions running one at a time, with no overlap</h3></a><a href=#serialisable-transactionstransactions-behaving-as-if-they-were-serial-but-may-be-executed-concurrently><h3 id=serialisable-transactionstransactions-behaving-as-if-they-were-serial-but-may-be-executed-concurrently><span class=hanchor arialabel=Anchor># </span>Serialisable Transactions↔Transactions behaving as if they were serial, but may be executed concurrently</h3></a><a href=#transactions-should-be-serialisable><h3 id=transactions-should-be-serialisable><span class=hanchor arialabel=Anchor># </span>Transactions should be <strong>serialisable</strong></h3></a><a href=#atomicity><h2 id=atomicity><span class=hanchor arialabel=Anchor># </span>Atomicity</h2></a><a href=#system-failure-partway-through-a-transaction-may-leave-the-database-in-an-inconsistent-state><h3 id=system-failure-partway-through-a-transaction-may-leave-the-database-in-an-inconsistent-state><span class=hanchor arialabel=Anchor># </span>System failure partway through a transaction may leave the database in an inconsistent state</h3></a><a href=#atomic-transactionsoperations-within-the-transaction-are-either-all-executed-successfully-or-not-executed-at-all><h3 id=atomic-transactionsoperations-within-the-transaction-are-either-all-executed-successfully-or-not-executed-at-all><span class=hanchor arialabel=Anchor># </span>Atomic Transactions↔Operations within the transaction are either all executed successfully or not executed at all</h3></a><a href=#transaction-problems><h2 id=transaction-problems><span class=hanchor arialabel=Anchor># </span>Transaction Problems</h2></a><a href=#basic-database-access-operations><h3 id=basic-database-access-operations><span class=hanchor arialabel=Anchor># </span>Basic Database Access Operations</h3></a><a href=#readxreads-a-database-item-x_d-into-a-program-variable-x_t-in-transaction-t><h4 id=readxreads-a-database-item-x_d-into-a-program-variable-x_t-in-transaction-t><span class=hanchor arialabel=Anchor># </span>read(X)→Reads a database item $X_d$ into a program variable $X_T$ in transaction $T$</h4></a><a href=#writexwrites-the-value-of-program-variable-x_t-in-transaction-t-into-the-database-item-x_d><h4 id=writexwrites-the-value-of-program-variable-x_t-in-transaction-t-into-the-database-item-x_d><span class=hanchor arialabel=Anchor># </span>write(X)→Writes the value of program variable $X_T$ in transaction $T$ into the database item $X_d$</h4></a><a href=#the-lost-update-problem--db-><h3 id=the-lost-update-problem--db-><span class=hanchor arialabel=Anchor># </span>The Lost Update Problem #Db ↓</h3></a><a href=#two-transactions-have-operations-interleaved-so-that-some-db-items-are-incorrect><h4 id=two-transactions-have-operations-interleaved-so-that-some-db-items-are-incorrect><span class=hanchor arialabel=Anchor># </span>Two transactions have operations interleaved so that some DB items are incorrect</h4></a><h4 id=400httpsremnote-user-datas3amazonawscom0xj0zqwiyutxk70k057dpcr_45qcjndoehok5r_hvvj8vkembq9bxtzrw4ytimydlgujkn_o1eye5ilv56dphk3vyb3zgonqmghfq_a8kjqzzdsmcur08vtbtdbbbdvrpng><img src=https://remnote-user-data.s3.amazonaws.com/0xJ0zQWiYuTxK70k057DPCr_45QcjNdOEHOK5R_HVvJ8VkEmbq9bxTzRW4YTIMYdLgUJkn_o1eYE5ilv56DPHk3vyb3zgOnQMgHfq_A8KjqzzdsmCuR08vTbtdbBbDVR.png width=400 alt=|400></h4><a href=#the-temporary-update-dirty-read-problem--db-><h3 id=the-temporary-update-dirty-read-problem--db-><span class=hanchor arialabel=Anchor># </span>The Temporary Update (Dirty Read) Problem #Db ↓</h3></a><a href=#one-transaction-updates-a-db-item-and-then-fails-item-is-accessed-before-reverting-to-its-original-value><h4 id=one-transaction-updates-a-db-item-and-then-fails-item-is-accessed-before-reverting-to-its-original-value><span class=hanchor arialabel=Anchor># </span>One transaction updates a DB item and then fails, item is accessed before reverting to its original value</h4></a><h4 id=400httpsremnote-user-datas3amazonawscom_xj32pt1u5jvbu4cdc1rc9qve4aaxserqgjyd2q2_ie75aran4q5ur3q3z-ym8ncv3chyfk1zi0id8myylqaxdfnyfozxre8zchkjr5vy3gn58rz6trm1ykagdupbihqpng><img src=https://remnote-user-data.s3.amazonaws.com/_xj32PT1u5jVbu4CDC1RC9QVE4aaXSErqGjYD2q2_iE75arAN4Q5uR3Q3Z-YM8Ncv3ChYFk1ZI0Id8MYYLqaxdFNYfozXre8zcHKjr5VY3gN58rz6trm1YKAgdUPBIhq.png width=400 alt=|400></h4><a href=#the-incorrect-summary-problem-><h3 id=the-incorrect-summary-problem-><span class=hanchor arialabel=Anchor># </span>The Incorrect Summary Problem ↓</h3></a><a href=#one-transaction-calculates-an-aggregate-summary-function-on-multiple-records-while-other-transactions-update-records><h4 id=one-transaction-calculates-an-aggregate-summary-function-on-multiple-records-while-other-transactions-update-records><span class=hanchor arialabel=Anchor># </span>One transaction calculates an aggregate summary function on multiple records while other transactions update records</h4></a><a href=#aggregate-function-may-read-some-values-before-they-are-updated-and-some-after><h4 id=aggregate-function-may-read-some-values-before-they-are-updated-and-some-after><span class=hanchor arialabel=Anchor># </span>Aggregate function may read some values before they are updated, and some after</h4></a><h4 id=400httpsremnote-user-datas3amazonawscompcpgl8nxhrpxhriyhkj7svzcyjffjd6pdjg_uakb4evl9qynlaot-0d5axo1jimylx0iwlsoq2nohdhv9mwulpzwo5vtlkrmjq0mj_1azbjdisjvdjzji36ispc4z_cmpng><img src=https://remnote-user-data.s3.amazonaws.com/pcPGl8nxHrpxhriYHkj7sVZcYJFfjd6pDjg_UaKb4EvL9QYnlAOt-0d5AXO1jImylX0iWlsOq2nOHdhV9mwULpzWO5VTlkrmJq0mj_1azbjdISjVdJZjI36ISpc4Z_CM.png width=400 alt=|400></h4><a href=#the-unrepeatable-read-problem--db-><h3 id=the-unrepeatable-read-problem--db-><span class=hanchor arialabel=Anchor># </span>The Unrepeatable Read Problem #Db ↓</h3></a><a href=#one-transaction-reads-an-item-twice-while-another-changes-the-item-between-the-two-reads><h4 id=one-transaction-reads-an-item-twice-while-another-changes-the-item-between-the-two-reads><span class=hanchor arialabel=Anchor># </span>One transaction reads an item twice, while another changes the item between the two reads</h4></a><h4 id=400httpsremnote-user-datas3amazonawscomafu1lfahedopb7x7ebfk1e9hxu3gxf8rckglqlijdpadsbfw8bpagtpt6bqxe2ipfiygshdufx71k-bvyoesejm87steuiz2y2uccszwvb2nvmvwzttv7gaunxtcwhkrpng><img src=https://remnote-user-data.s3.amazonaws.com/AFU1LfahEdOPB7x7eBfK1E9HXu3Gxf8rcKGlqlijDPadsbfW8BpAgTpt6bQXe2ipFiyGShdUFx71K-BvYOesejm87STeUIz2y2uCCSZwvB2NvMVwzTTV7gAUnXtcwHKR.png width=400 alt=|400></h4><a href=#transaction-processing><h2 id=transaction-processing><span class=hanchor arialabel=Anchor># </span>Transaction Processing</h2></a><a href=#when-a-transaction-is-submitted-for-execution-the-system-must-ensure-that-><h3 id=when-a-transaction-is-submitted-for-execution-the-system-must-ensure-that-><span class=hanchor arialabel=Anchor># </span>When a transaction is submitted for execution, the system must ensure that ↓</h3></a><a href=#all-operations-in-the-transaction-are-completed-successfully-with-effect-recorded-permanently-in-the-database-or><h4 id=all-operations-in-the-transaction-are-completed-successfully-with-effect-recorded-permanently-in-the-database-or><span class=hanchor arialabel=Anchor># </span>All operations in the transaction are completed successfully, with effect recorded permanently in the database, or</h4></a><a href=#there-is-no-effect-on-the-database-or-other-transactions><h4 id=there-is-no-effect-on-the-database-or-other-transactions><span class=hanchor arialabel=Anchor># </span>There is no effect on the database or other transactions</h4></a><a href=#transactions-may-be-read-only-or-update><h3 id=transactions-may-be-read-only-or-update><span class=hanchor arialabel=Anchor># </span>Transactions may be <strong>read-only}} or {{update</strong></h3></a><a href=#transaction-life-cycle-><h2 id=transaction-life-cycle-><span class=hanchor arialabel=Anchor># </span>Transaction Life Cycle ↓</h2></a><h3 id=400httpsremnote-user-datas3amazonawscommbsoi0e1bmu1ppnyj9kz8221n6ydydassjboz9zznj70wzhfz6lrnsycsmwgrdc3q_t9jjurgl9s0fxuex-nxg0yms1v2x5b4oo0gtkktgdi_lamsrvutbc1plqffemlpng><img src=https://remnote-user-data.s3.amazonaws.com/mBsOI0E1BMu1PPnYJ9kz8221N6ydydaSSJBOZ9zZnj70WzHFZ6LRnsyCSmWgRdc3Q_t9JJurGL9s0fXUeX-nxG0YmS1V2x5B4oO0gTKktgdi_LamsrVUTBc1PlQfFeml.png width=400 alt=|400></h3><a href=#acid><h2 id=acid><span class=hanchor arialabel=Anchor># </span>ACID</h2></a><a href=#acid-properties><h3 id=acid-properties><span class=hanchor arialabel=Anchor># </span>ACID Properties</h3></a><a href=#atomicitya-transaction-is-either-performed-completely-or-not-at-all--db><h4 id=atomicitya-transaction-is-either-performed-completely-or-not-at-all--db><span class=hanchor arialabel=Anchor># </span>Atomicity↔A transaction is either performed completely or not at all #Db</h4></a><a href=#consistencycorrect-transaction-execution-must-take-the-database-from-one-consistent-state-to-another--db><h4 id=consistencycorrect-transaction-execution-must-take-the-database-from-one-consistent-state-to-another--db><span class=hanchor arialabel=Anchor># </span>Consistency↔Correct transaction execution must take the database from one consistent state to another #Db</h4></a><a href=#isolationa-transaction-should-not-make-updates-externally-visible-to-other-transactions-until-committed--db><h4 id=isolationa-transaction-should-not-make-updates-externally-visible-to-other-transactions-until-committed--db><span class=hanchor arialabel=Anchor># </span>Isolation↔A transaction should not make updates externally visible (to other transactions) until committed #Db</h4></a><a href=#durabilityonce-database-is-changed-and-committed-changes-should-not-be-lost-because-of-failure--db><h4 id=durabilityonce-database-is-changed-and-committed-changes-should-not-be-lost-because-of-failure--db><span class=hanchor arialabel=Anchor># </span>Durability↔Once database is changed and committed, changes should not be lost because of failure #Db</h4></a><a href=#schedules><h3 id=schedules><span class=hanchor arialabel=Anchor># </span>Schedules</h3></a><a href=#a-schedule-s-of-n-transactions-is-an-ordering-of-the-operations-of-the-transactions-subject-to-the-constraint-that-for-each-transaction-t-that-participates-in-s-the-operations-in-t-must-appear-in-the-same-order-in-s-that-they-do-in-t><h4 id=a-schedule-s-of-n-transactions-is-an-ordering-of-the-operations-of-the-transactions-subject-to-the-constraint-that-for-each-transaction-t-that-participates-in-s-the-operations-in-t-must-appear-in-the-same-order-in-s-that-they-do-in-t><span class=hanchor arialabel=Anchor># </span>A schedule <strong>S</strong> of <strong>n</strong> transactions is <strong>an ordering of the operations of the transactions}}, subject to {{the constraint that for each transaction }}{{<strong>T</strong>}}{{ that participates in }}{{<strong>S</strong>}}, the operations in <strong>T</strong> must {{appear in the same order in }}{{<strong>S</strong>}}{{ that they do in }}{{<strong>T</strong></strong></h4></a><a href=#two-operations-in-a-schedule-are-conflicting-if-><h4 id=two-operations-in-a-schedule-are-conflicting-if-><span class=hanchor arialabel=Anchor># </span>Two operations in a schedule are conflicting if ↓</h4></a><a href=#they-belong-to-different-transactions-and><h5 id=they-belong-to-different-transactions-and><span class=hanchor arialabel=Anchor># </span>They belong to different transactions and</h5></a><ul><li>They access the same data item and</li><li>At least one of the operations is a write()</li></ul><a href=#serial-and-serialisable><h4 id=serial-and-serialisable><span class=hanchor arialabel=Anchor># </span>Serial and Serialisable</h4></a><ul><li>A schedule is serial if ↓<ul><li>For each transaction <strong>T</strong> in the schedule, all operations in <strong>T</strong> are executed consecutively (no interleaving)</li></ul></li><li>A schedule <strong>S</strong> of <strong>n</strong> transactions is serialisable if ↓<ul><li>It is equivalent to some serial schedule of the same <strong>n</strong> transactions</li></ul></li></ul><a href=#schedule-equivalence><h4 id=schedule-equivalence><span class=hanchor arialabel=Anchor># </span>Schedule Equivalence</h4></a><ul><li>Two schedules are result equivalent if <strong>they produce the same final state on the database</strong></li><li>Two schedules are conflict equivalent if <strong>the order of any two conflicting operations is the same in both schedules</strong></li></ul><a href=#non-serial-and-non-serialisable-schedule><h4 id=non-serial-and-non-serialisable-schedule><span class=hanchor arialabel=Anchor># </span>Non-Serial and Non-Serialisable Schedule</h4></a><ul><li><img src=https://remnote-user-data.s3.amazonaws.com/qN4OQunO6Jih9YMpd4TCNE-mfbtGQOEj5uftKQR_jGrbldRtVJlzY7eUNDkA1SsQ7rkjVwEgS4u02GfKroyC8P73SHuOXZ1rGtNrcxNcLaRhUbYD9M4DSQpFMt9lapr-.png width=400 alt=|400></li></ul><a href=#non-serial-but-serialisable-schedule><h4 id=non-serial-but-serialisable-schedule><span class=hanchor arialabel=Anchor># </span>Non-Serial but Serialisable Schedule</h4></a><ul><li><img src=https://remnote-user-data.s3.amazonaws.com/WaAFPrF-sqkYr8h3VNaugDfllkb7_mmgvxihq7xjB1d6LWbX4N0kXGPUy-h6N_LgEVHB7Qp88dGFAysMvvrLJJgtwHwhRHXEWslOi8OQ_J27zxfIUiMPJ8yVffX7C7_R.png width=400 alt=|400></li></ul><a href=#locking><h2 id=locking><span class=hanchor arialabel=Anchor># </span>Locking</h2></a><a href=#locks-are-used-to-synchronise-access-by-concurrent-transactions-to-a-database><h3 id=locks-are-used-to-synchronise-access-by-concurrent-transactions-to-a-database><span class=hanchor arialabel=Anchor># </span>Locks are used to synchronise access by concurrent transactions to a database</h3></a><a href=#modes><h3 id=modes><span class=hanchor arialabel=Anchor># </span>Modes</h3></a><a href=#sharedfor-reading--db><h4 id=sharedfor-reading--db><span class=hanchor arialabel=Anchor># </span>Shared→For reading #Db</h4></a><a href=#exclusivefor-writing--db><h4 id=exclusivefor-writing--db><span class=hanchor arialabel=Anchor># </span>Exclusive→For writing #Db</h4></a><a href=#lock-operations><h3 id=lock-operations><span class=hanchor arialabel=Anchor># </span>Lock Operations</h3></a><a href=#lock-sharedxattempt-to-acquire-a-shared-lock-on-x><h4 id=lock-sharedxattempt-to-acquire-a-shared-lock-on-x><span class=hanchor arialabel=Anchor># </span>lock-shared(X)↔Attempt to acquire a shared lock on X</h4></a><a href=#lock-exclusivexattempt-to-acquire-an-exclusive-lock-on-x><h4 id=lock-exclusivexattempt-to-acquire-an-exclusive-lock-on-x><span class=hanchor arialabel=Anchor># </span>lock-exclusive(X)↔Attempt to acquire an exclusive lock on X</h4></a><a href=#unlockxrelinquish-all-locks-on-x><h4 id=unlockxrelinquish-all-locks-on-x><span class=hanchor arialabel=Anchor># </span>unlock(X)↔Relinquish all locks on X</h4></a><a href=#lock-outcome--db-><h3 id=lock-outcome--db-><span class=hanchor arialabel=Anchor># </span>Lock Outcome #Db ↓</h3></a><h4 id=400httpsremnote-user-datas3amazonawscomsvtjpr85orvcqwlodnmdurcue-en2x_prhpif98imvo9goy1viwsfy1-ln9ympltazzesp9gbr2p9dyivkjfvypkiuvmotmzg8qofqoeq3acrbrxnq1xpscoepd3fswopng><img src=https://remnote-user-data.s3.amazonaws.com/SvTjpr85orvCQwLoDnMDurcUE-En2x_Prhpif98imVo9gOy1vIWSfY1-LN9YmpltaZZEsp9GbR2p9DyivkJFvyPKIuvmoTmZg8qoFqoeQ3AcrBrxnq1XPSCoEPD3FswO.png width=400 alt=|400></h4><a href=#the-result-of-an-attempt-to-obtain-a-lock-is-either-><h4 id=the-result-of-an-attempt-to-obtain-a-lock-is-either-><span class=hanchor arialabel=Anchor># </span>The result of an attempt to obtain a lock is either ↓</h4></a><ul><li>Grant lock (able to access the item)</li><li>Wait for lock to be granted (not yet able to access item)</li><li>Abort</li></ul><a href=#locking-rules><h3 id=locking-rules><span class=hanchor arialabel=Anchor># </span>Locking Rules</h3></a><a href=#must-issue-lock-sharedx-or-lock-exclusivex-before-a-readx-operation><h4 id=must-issue-lock-sharedx-or-lock-exclusivex-before-a-readx-operation><span class=hanchor arialabel=Anchor># </span>Must issue **<strong>lock-shared(X)**}} or {{<strong>lock-exclusive(X)</strong></strong> before a <strong>read(X)</strong> operation</h4></a><a href=#must-issue-lock-exclusivex-before-a-writex-operation><h4 id=must-issue-lock-exclusivex-before-a-writex-operation><span class=hanchor arialabel=Anchor># </span>Must issue <strong>lock-exclusive(X)</strong> before a <strong><strong>write(X)</strong></strong> operation</h4></a><a href=#must-issue-unlockx-after-all-readx-and-writex-operations-are-completed><h4 id=must-issue-unlockx-after-all-readx-and-writex-operations-are-completed><span class=hanchor arialabel=Anchor># </span>Must issue <strong>unlock(X)</strong> after all **<strong>read(X)**}} and {{<strong>write(X)</strong></strong> operations are completed</h4></a><a href=#cannot-issue-lock-sharedx-if-already-holding-a-lock-on-x><h4 id=cannot-issue-lock-sharedx-if-already-holding-a-lock-on-x><span class=hanchor arialabel=Anchor># </span>Cannot issue <strong>lock-shared(X)</strong> if <strong>already holding a lock on }}{{<strong>X</strong></strong></h4></a><a href=#cannot-issue-lock-exclusivex-if-already-holding-a-lock-on-x><h4 id=cannot-issue-lock-exclusivex-if-already-holding-a-lock-on-x><span class=hanchor arialabel=Anchor># </span>Cannot issue <strong>lock-exclusive(X)</strong> if <strong>already holding a lock on }}{{<strong>X</strong></strong></h4></a><a href=#cannot-issue-unlockx-unless-holding-a-lock-on-x><h4 id=cannot-issue-unlockx-unless-holding-a-lock-on-x><span class=hanchor arialabel=Anchor># </span>Cannot issue <strong>unlock(X)</strong> unless <strong>holding a lock on }}{{<strong>X</strong></strong></h4></a><a href=#lock-conversion><h3 id=lock-conversion><span class=hanchor arialabel=Anchor># </span>Lock Conversion</h3></a><a href=#rules-may-be-relaxed-in-order-to-allow-lock-conversion><h4 id=rules-may-be-relaxed-in-order-to-allow-lock-conversion><span class=hanchor arialabel=Anchor># </span>Rules may be relaxed in order to allow lock conversion</h4></a><ul><li>A <strong>lock-shared(X)</strong> may <strong>be upgraded to a }}{{<strong>lock-exclusive(X)</strong></strong></li><li>A <strong>lock-exclusive(X)</strong> may <strong>be downgraded to a }}{{<strong>lock-shared(X)</strong></strong></li></ul><a href=#locking-by-itself-isnt-enough-for-non-serial-schedules><h3 id=locking-by-itself-isnt-enough-for-non-serial-schedules><span class=hanchor arialabel=Anchor># </span>Locking, by itself, isn&rsquo;t enough for <strong>non-serial</strong> schedules</h3></a><a href=#two-phase-locking-2pl><h2 id=two-phase-locking-2pl><span class=hanchor arialabel=Anchor># </span>Two-Phase Locking (2PL)</h2></a><a href=#extra-rules-for-handling-locks-><h3 id=extra-rules-for-handling-locks-><span class=hanchor arialabel=Anchor># </span>Extra rules for handling locks ↓</h3></a><a href=#all-locking-operations-precede-the-first-unlock-operation-in-a-transaction><h4 id=all-locking-operations-precede-the-first-unlock-operation-in-a-transaction><span class=hanchor arialabel=Anchor># </span>All locking operations precede the first unlock operation in a transaction</h4></a><a href=#locks-are-only-released-after-a-transaction-commits-or-aborts><h4 id=locks-are-only-released-after-a-transaction-commits-or-aborts><span class=hanchor arialabel=Anchor># </span>Locks are only released after a transaction commits or aborts</h4></a><a href=#two-phases><h3 id=two-phases><span class=hanchor arialabel=Anchor># </span>Two Phases</h3></a><a href=#guarantees-serializable-transactions><h4 id=guarantees-serializable-transactions><span class=hanchor arialabel=Anchor># </span>Guarantees serializable transactions</h4></a><a href=#growing-phase--db-><h4 id=growing-phase--db-><span class=hanchor arialabel=Anchor># </span>Growing Phase #Db ↓</h4></a><ul><li>Obtain locks</li><li>Access data items</li></ul><a href=#shrinking-phase--db-><h4 id=shrinking-phase--db-><span class=hanchor arialabel=Anchor># </span>Shrinking Phase #Db ↓</h4></a><ul><li>Release locks</li></ul><a href=#deadlock--db-><h2 id=deadlock--db-><span class=hanchor arialabel=Anchor># </span>Deadlock #Db ↓</h2></a><a href=#when-two-or-more-transactions-are-waiting-for-each-other-to-release-a-lock-on-an-item><h3 id=when-two-or-more-transactions-are-waiting-for-each-other-to-release-a-lock-on-an-item><span class=hanchor arialabel=Anchor># </span>When two or more transactions are waiting for each other to release a lock on an item</h3></a><h3 id=400httpsremnote-user-datas3amazonawscomfbcai_ui6nbuxko5jekgfd8cm0mufwlio5zcz2zrqfq8uxsdwbe8bfa8lqds3gwg16xbf2lcx7vnsdsvgauzfuugmgxrdlbfae2wiauspxbbfi4bxk9p2logy9tkjfggpng><img src=https://remnote-user-data.s3.amazonaws.com/FBCAi_uI6NbuXKo5JekgFD8cM0muFwLiO5Zcz2ZRQFQ8UxSDwBe8BFa8LQDS3gWg16xBF2lCx7vNsdsVgAuzFuUGmgxRdLbfAE2wIAuspXbbFi4Bxk9P2lOgY9tkjFgG.png width=400 alt=|400></h3><a href=#conditions-for-deadlock-to-occur-><h3 id=conditions-for-deadlock-to-occur-><span class=hanchor arialabel=Anchor># </span>Conditions for deadlock to occur ↓</h3></a><a href=#concurrencytwo-processes-claim-exclusive-control-of-one-resource><h4 id=concurrencytwo-processes-claim-exclusive-control-of-one-resource><span class=hanchor arialabel=Anchor># </span>Concurrency→Two processes claim exclusive control of one resource</h4></a><a href=#holdone-process-continues-to-hold-exclusively-controlled-resources-until-its-need-is-satisfied><h4 id=holdone-process-continues-to-hold-exclusively-controlled-resources-until-its-need-is-satisfied><span class=hanchor arialabel=Anchor># </span>Hold→One process continues to hold exclusively controlled resources until its need is satisfied</h4></a><a href=#waitprocesses-wait-in-queues-for-additional-resources-while-holding-resources-already-allocated><h4 id=waitprocesses-wait-in-queues-for-additional-resources-while-holding-resources-already-allocated><span class=hanchor arialabel=Anchor># </span>Wait→Processes wait in queues for additional resources while holding resources already allocated</h4></a><a href=#mutual-dependency><h4 id=mutual-dependency><span class=hanchor arialabel=Anchor># </span>Mutual dependency</h4></a><a href=#dealing-with-deadlock><h3 id=dealing-with-deadlock><span class=hanchor arialabel=Anchor># </span>Dealing with Deadlock</h3></a><a href=#deadlock-prevention-><h4 id=deadlock-prevention-><span class=hanchor arialabel=Anchor># </span>Deadlock Prevention ↓</h4></a><ul><li>Every transaction locks all items it needs in advance, if an item cannot be obtained , no items are locked</li><li>Transactions updating the same resources are not allowed to execute concurrently</li></ul><a href=#deadlock-detection><h4 id=deadlock-detection><span class=hanchor arialabel=Anchor># </span>Deadlock Detection</h4></a><ul><li>Wait-for graph<ul><li><img src=https://remnote-user-data.s3.amazonaws.com/rzhWKROsrr_L7POjqyVWPyTgJ7vv8lDYr9_v_tOYViPmqhQux8f0pIbwjXZoOAFv-qBMxVNUE2wP-1QgJntOOhM6LNQkiFV6HuoLHlf6Fnt4hR5e9kS8HixBBL1HKmIF.png width=400 alt=|400><ul><li>Representation of <strong>interactions between transactions</strong> #Db</li><li>Directed graph containing ↓<ul><li>A vertex for each transaction that is currently executing</li><li>An edge from T1 to T2 if T1 is waiting to lock an item that is currently locked by T2</li></ul></li><li>Deadlock exists iff <strong>the Wait-For Graph contains a cycle</strong> #Db</li></ul></li></ul></li><li>Timeouts ↓<ul><li>If a transaction waits for a resource for longer than a given period (the timeout), the system assumes that the transaction is deadlocked and aborts it</li></ul></li></ul><a href=#granularity-and-concurrency><h2 id=granularity-and-concurrency><span class=hanchor arialabel=Anchor># </span>Granularity and Concurrency</h2></a><a href=#coarser-granularity-gives-lower-degree-of-concurrency><h3 id=coarser-granularity-gives-lower-degree-of-concurrency><span class=hanchor arialabel=Anchor># </span>Coarser granularity gives <strong>lower</strong> degree of concurrency</h3></a><a href=#finer-granularity-gives-higher-overhead><h3 id=finer-granularity-gives-higher-overhead><span class=hanchor arialabel=Anchor># </span>Finer granularity gives <strong>higher</strong> overhead</h3></a><a href=#timestamps-><h2 id=timestamps-><span class=hanchor arialabel=Anchor># </span>Timestamps ↓</h2></a><a href=#alternative-to-locks><h3 id=alternative-to-locks><span class=hanchor arialabel=Anchor># </span>Alternative to locks</h3></a><a href=#timestamps-are-unique-identifiers-for-transactions><h3 id=timestamps-are-unique-identifiers-for-transactions><span class=hanchor arialabel=Anchor># </span>Timestamps are <strong>unique identifiers for transactions</strong></h3></a><a href=#tsttransaction-start-time><h3 id=tsttransaction-start-time><span class=hanchor arialabel=Anchor># </span>TS(T)→Transaction start time</h3></a><a href=#each-resource-x-has-><h3 id=each-resource-x-has-><span class=hanchor arialabel=Anchor># </span>Each resource <strong>X</strong> has ↓</h3></a><a href=#a-read-timestamp-read-tsxadvanced-databasesweek-6transactions-and-concurrencytimestampseach-resource-x-hasa-read-timestamp-read-tsxread-tsxmd><h4 id=a-read-timestamp-read-tsxadvanced-databasesweek-6transactions-and-concurrencytimestampseach-resource-x-hasa-read-timestamp-read-tsxread-tsxmd><span class=hanchor arialabel=Anchor># </span>A read timestamp ([read-TS(X)](Advanced Databases/Week 6/Transactions and Concurrency/Timestamps/Each resource X has/A read timestamp (read-TS(X))/read-TS(X).md))</h4></a><ul><li>**read-TS(X)**↔Set to the most recent timestamp of the most recent read transaction that accessed resource <strong>X</strong></li></ul><a href=#a-write-timestamp-write-tsxadvanced-databasesweek-6transactions-and-concurrencytimestampseach-resource-x-hasa-write-timestamp-write-tsxwrite-tsxmd><h4 id=a-write-timestamp-write-tsxadvanced-databasesweek-6transactions-and-concurrencytimestampseach-resource-x-hasa-write-timestamp-write-tsxwrite-tsxmd><span class=hanchor arialabel=Anchor># </span>A write timestamp ([write-TS(X)](Advanced Databases/Week 6/Transactions and Concurrency/Timestamps/Each resource X has/A write timestamp (write-TS(X))/write-TS(X).md))</h4></a><ul><li>**write-TS(X)**↔Set to the most recent timestamp of the most recent write transaction that accessed resource <strong>X</strong></li></ul><a href=#timestamp-ordering><h3 id=timestamp-ordering><span class=hanchor arialabel=Anchor># </span>Timestamp Ordering</h3></a><a href=#transactions-are-ordered-based-on-their-timestamps><h4 id=transactions-are-ordered-based-on-their-timestamps><span class=hanchor arialabel=Anchor># </span>Transactions are ordered based on their <strong>timestamps</strong></h4></a><a href=#for-each-resource-accessed-by-conflicting-operations-the-order-in-which-the-resource-is-accessed-must-not-violate-the-serialisability-order><h4 id=for-each-resource-accessed-by-conflicting-operations-the-order-in-which-the-resource-is-accessed-must-not-violate-the-serialisability-order><span class=hanchor arialabel=Anchor># </span>For each resource accessed by conflicting operations, the order in which the resource is accessed must not violate the serialisability order</h4></a><a href=#basic-timestamp-ordering-><h3 id=basic-timestamp-ordering-><span class=hanchor arialabel=Anchor># </span>Basic Timestamp Ordering ↓</h3></a><a href=#tst-is-compared-with-read-tsxadvanced-databasesweek-6transactions-and-concurrencytimestampseach-resource-x-hasa-read-timestamp-read-tsxread-tsxmd-and-write-tsxadvanced-databasesweek-6transactions-and-concurrencytimestampseach-resource-x-hasa-write-timestamp-write-tsxwrite-tsxmd-><h4 id=tst-is-compared-with-read-tsxadvanced-databasesweek-6transactions-and-concurrencytimestampseach-resource-x-hasa-read-timestamp-read-tsxread-tsxmd-and-write-tsxadvanced-databasesweek-6transactions-and-concurrencytimestampseach-resource-x-hasa-write-timestamp-write-tsxwrite-tsxmd-><span class=hanchor arialabel=Anchor># </span><strong>TS(T)</strong> is compared with [read-TS(X)](Advanced Databases/Week 6/Transactions and Concurrency/Timestamps/Each resource X has/A read timestamp (read-TS(X))/read-TS(X).md) and [write-TS(X)](Advanced Databases/Week 6/Transactions and Concurrency/Timestamps/Each resource X has/A write timestamp (write-TS(X))/write-TS(X).md) ↓</h4></a><ul><li>Has this item been read or written before transaction <strong>T</strong> has had an opportunity to read/write?</li><li>Ensure that timestamp ordering is not violated</li></ul><a href=#if-timestamp-ordering-is-violated-transaction-is-aborted-and-resubmitted-with-a-new-timestamp><h4 id=if-timestamp-ordering-is-violated-transaction-is-aborted-and-resubmitted-with-a-new-timestamp><span class=hanchor arialabel=Anchor># </span>If timestamp ordering is violated, <strong>transaction is aborted and resubmitted with a new timestamp</strong></h4></a><a href=#writex-><h4 id=writex-><span class=hanchor arialabel=Anchor># </span><strong>write(X)</strong> ↓</h4></a><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash></code></pre></td></tr></table></div></div></li></ul><p>if TS(T) >= read-TS(X) and TS(T) >= write-TS(X)
then
#execute write(X)
#set write-TS(X) to TS(T)
else
#abort and rollback T</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#### ![|400](https://remnote-user-data.s3.amazonaws.com/fLeHkAUBkoe3Qk8YXQyL2ptla3XAb1XC12Zgn62kZJQ0G0WXFhE-zdHUHKuTVLktm3xvNcvSnVKgZDi65V1VZ6p-J5IkaZp-or6NM1tCWBF2hbfkLg5fScgqOCop-kvf.gif) 
</span></span><span class=line><span class=cl>#### **read(X)** ↓ 
</span></span><span class=line><span class=cl>- ```bash
</span></span><span class=line><span class=cl>if TS(T) &gt;= write-TS(X)
</span></span><span class=line><span class=cl>then
</span></span><span class=line><span class=cl>#execute read(X)
</span></span><span class=line><span class=cl>#set read-TS(X) to max(TS(T), read-TS(X))
</span></span><span class=line><span class=cl>else
</span></span><span class=line><span class=cl>#abort and rollback T
</span></span></code></pre></td></tr></table></div></div><a href=#dirty-read--><h4 id=dirty-read--><span class=hanchor arialabel=Anchor># </span>Dirty Read ↓</h4></a><ul><li>Transaction updates a DB item and then fails</li><li>Item is accessed before reverting to original value</li><li><img src=https://remnote-user-data.s3.amazonaws.com/Iwnqtiyt2It7ckKadfG1_vUr_ygMSFTjkoQipxtibtcyfaPWSdm5omJluAOKU2e82sxxJiNuf2LmMBGnxc7c1MBr9YG88nDp73DBl3SiJ8bXa7iQ2jWVTnOe9kZagPDx.png width=400 alt=|400><ul><li>We can address dirty reads by adding a commit bit <strong>commit(X)</strong> that indicates whether the most recent transaction to write to <strong>X</strong> has been committed</li><li><strong>read(X)</strong> for Dirty Read<ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash></code></pre></td></tr></table></div></div></li></ul></li></ul></li></ul><p>if TS(T) >= write-TS(X)
then
#if commit(X) is true
#then
##execute read(X)
##set read-TS(X) to max(TS(T), read-TS(X))
#else
##delay execution until commit(X) is true
else
#abort and rollback T</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>	- **write(X)** for Dirty Read
</span></span><span class=line><span class=cl>		- ```bash
</span></span><span class=line><span class=cl>if TS(T) &gt;= read-TS(X) and TS(T) &gt;= write-TS(X)
</span></span><span class=line><span class=cl>then
</span></span><span class=line><span class=cl>#execute write(X)
</span></span><span class=line><span class=cl>#set commit(X) to false
</span></span><span class=line><span class=cl>#set write-TS(X) to TS(T)
</span></span><span class=line><span class=cl>else
</span></span><span class=line><span class=cl>#abort and rollback T
</span></span></code></pre></td></tr></table></div></div><a href=#thomas-write-rule-><h3 id=thomas-write-rule-><span class=hanchor arialabel=Anchor># </span>Thomas&rsquo; Write Rule ↓</h3></a><a href=#modification-of-basic-timestamp-ordering-that-rejects-fewer-write-operations><h4 id=modification-of-basic-timestamp-ordering-that-rejects-fewer-write-operations><span class=hanchor arialabel=Anchor># </span>Modification of Basic Timestamp Ordering that rejects fewer write operations</h4></a><a href=#weakens-the-checks-for-writex-so-that-obsolete-write--operations-are-ignored><h4 id=weakens-the-checks-for-writex-so-that-obsolete-write--operations-are-ignored><span class=hanchor arialabel=Anchor># </span>Weakens the checks for <strong>write(X)</strong> so that obsolete write operations are ignored</h4></a><a href=#does-not-enforce-serialisability><h4 id=does-not-enforce-serialisability><span class=hanchor arialabel=Anchor># </span>Does not enforce serialisability</h4></a><a href=#write-rule-><h4 id=write-rule-><span class=hanchor arialabel=Anchor># </span>Write Rule ↓</h4></a><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash></code></pre></td></tr></table></div></div></li></ul><p>if TS(T) >= read-TS(X) and TS(T) >= write-TS(X)
then
#execute write(X)
#set commit(X) to false
#set write-TS(X) to TS(T)
else if TS(T) >= read-TS(X) and TS(T) &lt; write-TS(X)
#if commit(X) is true
##ignore write(X)
#else
##delay execution until commit(X) is true
else
#abort and rollback T</p><a href=#timestamp-ordering-1><h3 id=timestamp-ordering-1><span class=hanchor arialabel=Anchor># </span>Timestamp Ordering</h3></a><a href=#transactions-are-ordered-based><h4 id=transactions-are-ordered-based><span class=hanchor arialabel=Anchor># </span>Transactions are ordered based</h4></a><a href=#advanced-transactions><h2 id=advanced-transactions><span class=hanchor arialabel=Anchor># </span>Advanced Transactions</h2></a><a href=#flat-transactions-><h3 id=flat-transactions-><span class=hanchor arialabel=Anchor># </span>Flat Transactions ↓</h3></a><a href=#basic-building-block><h4 id=basic-building-block><span class=hanchor arialabel=Anchor># </span>Basic building block</h4></a><a href=#only-one-level-of-control-by-the-application><h4 id=only-one-level-of-control-by-the-application><span class=hanchor arialabel=Anchor># </span>Only one level of control by the application</h4></a><a href=#all-or-nothing-commit-or-abort><h4 id=all-or-nothing-commit-or-abort><span class=hanchor arialabel=Anchor># </span>All-or-nothing (Commit or abort)</h4></a><a href=#simplest-type><h4 id=simplest-type><span class=hanchor arialabel=Anchor># </span>Simplest type</h4></a><a href=#long-duration-transactions-><h3 id=long-duration-transactions-><span class=hanchor arialabel=Anchor># </span>Long Duration Transactions ↓</h3></a><a href=#more-susceptible-to-failure-and-rollback-not-acceptable><h4 id=more-susceptible-to-failure-and-rollback-not-acceptable><span class=hanchor arialabel=Anchor># </span>More susceptible to failure (and rollback not acceptable)</h4></a><a href=#may-lock-and-access-many-data-items-increases-chance-of-deadlock><h4 id=may-lock-and-access-many-data-items-increases-chance-of-deadlock><span class=hanchor arialabel=Anchor># </span>May lock and access many data items (increases chance of deadlock)</h4></a><a href=#savepoints-><h3 id=savepoints-><span class=hanchor arialabel=Anchor># </span>Savepoints ↓</h3></a><a href=#an-identifiable-point-in-a-flat-transaction-representing-a-partially-consistent-state-which-can-be-used-as-an-internal-restart-point-for-the-transaction><h4 id=an-identifiable-point-in-a-flat-transaction-representing-a-partially-consistent-state-which-can-be-used-as-an-internal-restart-point-for-the-transaction><span class=hanchor arialabel=Anchor># </span>An identifiable point in a flat transaction representing a partially consistent state which can be used as an internal restart point for the transaction</h4></a><a href=#used-for-deadlock-handling><h4 id=used-for-deadlock-handling><span class=hanchor arialabel=Anchor># </span>Used for <strong>deadlock handling</strong></h4></a><a href=#savepoints-may-be-persistent-><h4 id=savepoints-may-be-persistent-><span class=hanchor arialabel=Anchor># </span>Savepoints may be persistent ↓</h4></a><ul><li>Following a system crash, restart active transactions from their most recent savepoints</li></ul><h4 id=400httpsremnote-user-datas3amazonawscom5t9songpiitjtzfoqkao8uc20egemwq1ylxrwobxwmzdqpxxc_njxmyfwhtaweb70sgkzcc_lxkbybd6b1-va_ddzavernhvhidlhinuxap-yltethkayqnnxz965jtmpng><img src=https://remnote-user-data.s3.amazonaws.com/5t9sONgpIItjtzfoqkAo8Uc20egEmWQ1YLXrWoBxwMzDQPXxc_NjXmYFWhTAwEB70sgKZCC_LxkbyBd6b1-Va_DdzAVeRnHVHIdlHInUxap-yLteThKAYQnNxz965jTm.png width=400 alt=|400></h4><a href=#chained-transactions-><h3 id=chained-transactions-><span class=hanchor arialabel=Anchor># </span>Chained Transactions ↓</h3></a><a href=#transactions-broken-into-sub-transactions-which-are-executed-serially><h4 id=transactions-broken-into-sub-transactions-which-are-executed-serially><span class=hanchor arialabel=Anchor># </span>Transactions broken into sub-transactions which are executed serially</h4></a><a href=#on-chaining-to-the-next-sub-transaction-><h4 id=on-chaining-to-the-next-sub-transaction-><span class=hanchor arialabel=Anchor># </span>On chaining to the next sub-transaction ↓</h4></a><ul><li>Commit results</li><li>Keep (some) locks</li></ul><a href=#cannot-rollback-to-previous-sub-transaction><h4 id=cannot-rollback-to-previous-sub-transaction><span class=hanchor arialabel=Anchor># </span>Cannot <strong>rollback to previous sub-transaction</strong></h4></a><h4 id=400httpsremnote-user-datas3amazonawscom2sxizeliw72nmqiipwzyge9vxot2ocagyopsf1ekzk1hbdmjypj_01-zq4wbxq2-tohbzideqroxxupgy9fd904tcuj1ehnbkzlehr7b_jubwb-t7af2uldaejjp56-hpng><img src=https://remnote-user-data.s3.amazonaws.com/2sxIZElIW72NMqIIPWzYGe9vXoT2OcagYOpSF1EkZK1HBdMJyPj_01-Zq4WbxQ2-tOHbZidEqRoxXUPgy9Fd904TCuJ1ehNbKZleHR7B_jUBwb-T7Af2UlDaEJjP56-h.png width=400 alt=|400></h4><a href=#savepoints-vs-chained-transactions><h3 id=savepoints-vs-chained-transactions><span class=hanchor arialabel=Anchor># </span>Savepoints vs Chained Transactions</h3></a><a href=#both-allow-substructure-to-be-imposed-on-a-long-running-application-program><h4 id=both-allow-substructure-to-be-imposed-on-a-long-running-application-program><span class=hanchor arialabel=Anchor># </span>Both allow <strong>substructure to be imposed on a long-running application program</strong></h4></a><ul><li>Database context is preserved</li><li>Cursors are kept</li></ul><a href=#commit-vs-savepoint><h4 id=commit-vs-savepoint><span class=hanchor arialabel=Anchor># </span>Commit vs Savepoint</h4></a><ul><li>Chained→Rollback only to previous &lsquo;savepoint&rsquo;</li><li>Savepoints→Can rollback to arbitrary savepoint</li></ul><a href=#locks><h4 id=locks><span class=hanchor arialabel=Anchor># </span>Locks</h4></a><ul><li><strong>Chained transactions</strong> free unwanted locks</li></ul><a href=#work-lost><h4 id=work-lost><span class=hanchor arialabel=Anchor># </span>Work Lost</h4></a><ul><li><strong>Savepoints}} more flexible than {{flat transactions</strong>, as long as the system does crash</li></ul><a href=#restart><h4 id=restart><span class=hanchor arialabel=Anchor># </span>Restart</h4></a><ul><li><strong>Chained transactions</strong> can restart from most recent commit, as long as no processing context hidden in local programming variables</li></ul><a href=#both-organise-work-into-a-sequence-of-actions><h4 id=both-organise-work-into-a-sequence-of-actions><span class=hanchor arialabel=Anchor># </span>Both organise <strong>work into a sequence of actions</strong></h4></a><a href=#nested-transactions-><h3 id=nested-transactions-><span class=hanchor arialabel=Anchor># </span>Nested Transactions ↓</h3></a><a href=#transaction-forms-a-hierarchy-of-sub-transactions><h4 id=transaction-forms-a-hierarchy-of-sub-transactions><span class=hanchor arialabel=Anchor># </span>Transaction forms a hierarchy of sub-transactions</h4></a><a href=#sub-transactions-may-abort-without-aborting-their-parent-transaction><h4 id=sub-transactions-may-abort-without-aborting-their-parent-transaction><span class=hanchor arialabel=Anchor># </span>Sub-transactions may abort without <strong>aborting their parent transaction</strong></h4></a><a href=#rules-for-nested-transactions><h4 id=rules-for-nested-transactions><span class=hanchor arialabel=Anchor># </span>Rules for Nested Transactions</h4></a><ul><li>Commit Rule ↓<ul><li>The commit of a sub-transaction makes the results accessible only to the parent</li><li>The final commit happens only when all ancestors finally commit</li></ul></li><li>Rollback Rule ↓<ul><li>If any [sub]transaction rolls back, all of its sub-transactions roll back</li></ul></li><li>Visibility Rule ↓<ul><li>Changes made by a sub-transaction are visible to its parent</li><li>Objects held by a parent can be made accessible to sub-transactions</li><li>Changes made by a sub-transaction are not visible to its siblings</li></ul></li></ul><h4 id=400httpsremnote-user-datas3amazonawscomqqqidx5wrfk2jbgnwi5ujdhsjdf7blziibicspxjftnv3_jekaprexxkmpdb5znbe4rjnsj-orsj6gnysrplgjodowezc-dbkhgwjwj7ot1z4v8nkhb4u2etl-f4tqmlpng><img src=https://remnote-user-data.s3.amazonaws.com/qQQidx5WRfK2jBGnWi5UjdhsjDF7bLZIIBIcspXJFTnV3_jEkApREXxkmPdB5ZnBE4RjnSJ-ORSj6GNYsRPLGjODOwEzc-dbkhGwJWj7OT1Z4V8nkhB4U2eTL-f4tqml.png width=400 alt=|400></h4><a href=#observations><h4 id=observations><span class=hanchor arialabel=Anchor># </span>Observations</h4></a><ul><li>Sub-transactions are not fully equivalent to flat transactions<ul><li>Atomic</li><li>Consistency preserving</li><li>Isolated</li><li>Not durable, because of the commit rule</li></ul></li><li>Nesting and program modularisation complement each other<ul><li>Well designed module has clean interface and no global variables</li><li>If it touches the database, the database is a large global variable</li><li>If the module is protected as a sub-transaction, then database changes are kept clean to</li></ul></li><li>Nested transactions permit intra-transaction parallelism</li></ul><a href=#emulating-nesting-with-savepoints><h3 id=emulating-nesting-with-savepoints><span class=hanchor arialabel=Anchor># </span>Emulating Nesting with Savepoints</h3></a><h4 id=400httpsremnote-user-datas3amazonawscomsgkpljekyxk2zj9ojhv-6noalnjhdc6wpib-847ohllt9vtfl7ox3znwesys9wojw0q32gifplpjkce-yf5qze1rm6aeb71wteuftvpmjz9t70xqg1ngyqpkdih2ijkepng><img src=https://remnote-user-data.s3.amazonaws.com/sgKPLJekYxK2zj9Ojhv-6NoaLnJhdC6WPIB-847OHlLt9VTFL7ox3znWesys9WoJw0q32GIFPlPJKCe-yf5Qze1rM6aeB71wTeUftvpMjZ9T70XqG1nGyqpKDiH2iJke.png width=400 alt=|400></h4><a href=#observations-1><h4 id=observations-1><span class=hanchor arialabel=Anchor># </span>Observations</h4></a><ul><li>Using savepoints is <strong>more}} flexible than nested transactions for internal recovery as {{you can roll back further</strong></li><li>True nested transactions are needed in order to run sub-transactions in parallel<ul><li>Emulating with savepoints need &lsquo;sub-transactions&rsquo; to be run in strict sequence</li></ul></li><li>True nested transactions can pass locks selectively<ul><li>More flexible than savepoints</li></ul></li></ul><a href=#sagas-><h3 id=sagas-><span class=hanchor arialabel=Anchor># </span>Sagas ↓</h3></a><a href=#a-collection-of-actions-flat-transactions-that-form-a-long-duration-transaction><h4 id=a-collection-of-actions-flat-transactions-that-form-a-long-duration-transaction><span class=hanchor arialabel=Anchor># </span>A collection of actions (flat transactions) that form a long duration transaction</h4></a><a href=#execution-based-around-notion-of-compensating-transactions-><h4 id=execution-based-around-notion-of-compensating-transactions-><span class=hanchor arialabel=Anchor># </span>Execution based around notion of compensating transactions ↓</h4></a><ul><li>Inverse of actions that allow them to be selectively rolled back</li><li>Used to recover from partial execution</li></ul><a href=#sagas-specified-as-a-digraph--><h4 id=sagas-specified-as-a-digraph--><span class=hanchor arialabel=Anchor># </span>Sagas specified as a <strong>digraph</strong> ↓</h4></a><ul><li>Nodes are either actions or the terminal nodes abort and complete</li><li>One node is designated the start</li><li>Paths in graph represent <strong>sequences of actions</strong><ul><li>Paths leading to abort are <strong>sequences of actions that cause the overall transaction to be rolled back</strong></li><li>Paths leading to complete are <strong>successful sequences that make persistent changes to the database</strong></li></ul></li></ul><a href=#saga-execution-><h4 id=saga-execution-><span class=hanchor arialabel=Anchor># </span>Saga Execution ↓</h4></a><ul><li>Each action $A$ has a compensating transaction $A^{-1}$</li><li>Assume if $A$ is an action and $\alpha$ is a sequence of legal actions, then $A\alpha A^{-1}\equiv \alpha$</li><li>If execution of a saga leads to abort, roll back the saga by executing the compensating transactions</li></ul><a href=#logging-and-recovery><h1 id=logging-and-recovery><span class=hanchor arialabel=Anchor># </span>Logging and Recovery</h1></a><ul><li></li><li><strong><strong>&lt; T, X, old ></strong></strong> →Transaction <strong>T</strong> has changed database item <strong>X</strong> from its old value</li></ul><a href=#rules><h4 id=rules><span class=hanchor arialabel=Anchor># </span>Rules</h4></a><ul><li>U1: If transaction <strong>T</strong> modifies database item <strong>X</strong>, then a log record of the form <strong><strong>&lt; T, X, old ></strong></strong> must be written to disk before the new value of <strong>X</strong> is output to disk</li><li>U2: If a transaction <strong>T</strong> commits, then its <strong><strong>&lt; commit T ></strong></strong> log record must be written to disk only after all database items changed by <strong>T</strong> have been output to disk</li></ul><a href=#example><h4 id=example><span class=hanchor arialabel=Anchor># </span>Example</h4></a><ul><li><img src=https://remnote-user-data.s3.amazonaws.com/tSAFD2QgnQQW6TGtdyep-bRiN6ysl0gR-hZHoYffKMdD96uYD3setsV1lolag1lMVYAp91x2Uv5VBZLPzbNRdxlwF-47Ar2__uOjpP9ZpcK-ztAEuFL1BWYjrmesZeNg.png width=400 alt=|400></li><li>X_m is value in memory buffer</li><li>X_d is value in disc</li></ul><a href=#recovery-with-undo-logging><h4 id=recovery-with-undo-logging><span class=hanchor arialabel=Anchor># </span>Recovery with Undo Logging</h4></a><ul><li></li><li>Introduce a periodic checkpoint in the log<ul><li>Only need to search backwards through the log to the most recent checkpoint</li><li>Before the checkpoint, all transactions have <strong>committed or aborted</strong></li></ul></li><li>Disadvantage of this approach→Must scan the entire log</li><li>New log record type<ul><li><strong><strong>&lt; ckpt ></strong></strong> →The database has been checkpointed</li></ul></li><li>Process ↓
######1. Stop accepting new transactions
######2. Wait until all active transactions commit/abort and write <strong><strong>&lt; commit T > / &lt; abort T ></strong></strong> to the log
######3. Flush log
######4. Write <strong><strong>&lt; ckpt ></strong></strong> to log
######5. Flush log
######6. Resume accepting transactions<ul><li><img src=https://remnote-user-data.s3.amazonaws.com/M1KttrN-QJr-1T5Vs6kLxVXpT5ekXu-drXceiF5KIm_pZF2YDd2e_XlxINcUk-vw819tSjueWx4AnuFTgXM796t_eB9AjhTfkdcjthh42feobXY5hdYhkO_Zo2cZct-u.gif width=400 alt=|400></li></ul></li><li>Nonquiescent Checkpointing<ul><li>Need to stop transaction processing while checkpointing<ul><li>Allow new transactions to enter the system during <strong>the checkpoint</strong></li><li>System may appear to <strong>stall</strong></li></ul></li><li>New log record types<ul><li><strong><strong>&lt; start ckpt (</strong></strong> T_1 <strong><strong>&mldr;</strong></strong> T_n <strong>**) > **</strong> →Checkpoint starts T_1 &mldr; T_n are active transactions that have not yet committed</li><li><strong><strong>&lt; end ckpt ></strong></strong> →Checkpoint ends</li></ul></li><li>Process #Db ↓
#######1. Write <strong><strong>&lt; start ckpt (</strong></strong> $T_1$ <strong><strong>&mldr;</strong></strong> $T_n$ <strong><strong>) ></strong></strong> to log and flush log
#######2. Wait until $T_1$&mldr;$T_n$ have all committed or aborted
#######3. Write <strong>**&lt; end ckpt > **</strong> to log and flush log</li><li><img src=https://remnote-user-data.s3.amazonaws.com/rbhPcMibLM5hqdxR028mWmYiwqah_WXLkCFbFdxWDdH1ySzykJiUpzsB4Q6yzuPQASjimcjnr3ngLtk0dwbCwAJYd819ufaXoDp2EiXGp9FfuTAKK_ev0Jg3Ul2LGmRT.png width=400 alt=|400></li></ul></li><li>Recovery with Checkpointed Undo Logging<ul><li>Two cases for recovery depending on latest checkpoint log record<ul><li><strong><strong>&lt; end ckpt ></strong></strong> appears latest<ul><li><img src=https://remnote-user-data.s3.amazonaws.com/JkL1RusysYRMCumVqdGChlgvzXp-GU9PPYIGW5Nr3aDqwuhOxOiAqN2CVSgo82TSdsJ6nOBpsJ5aTwJo2NJ1PVmsbrhi_M5EsZksjgsktt6PItvjr1B8rM88INl4M-J2.png width=400 alt=|400></li><li>All incomplete transactions began after the previous <strong><strong>&lt; start ckpt (&mldr;) ></strong></strong></li><li>Disregard the log before the previous <strong><strong>&lt; start ckpt (&mldr;) ></strong></strong></li></ul></li><li><strong>**&lt; start ckpt ( **</strong> T_1&mldr;T_n <strong>**) > **</strong> appears latest<ul><li>Disregard the log before the start of the earliest incomplete transaction</li><li>System crash occurred during checkpoint</li><li>Incomplete transactions are those encountered after the <strong><strong>&lt; start ckpt (&mldr;) ></strong></strong> and those of T_1&mldr;T_n that were not committed before the crash</li><li><img src=https://remnote-user-data.s3.amazonaws.com/yfP933fBuewfhDWciSUka2qicExou_n0k3bWFMsUgk4PuJgn3TOu9-9j0PmmZlEBceGNePwMcbBibzJjl61_B7XNr8pIaCMW93zQemBeDH7eYjX30iNx2R7LFCaBQ4-X.png width=400 alt=|400></li></ul></li></ul></li></ul></li></ul><a href=#redo-logging><h3 id=redo-logging><span class=hanchor arialabel=Anchor># </span>Redo Logging</h3></a><a href=#write--__-commit-t-__--log-record-to-disk-before-changed-values-are-written-to-disk><h4 id=write--__-commit-t-__--log-record-to-disk-before-changed-values-are-written-to-disk><span class=hanchor arialabel=Anchor># </span>Write <strong><strong>&lt; commit T ></strong></strong> log record to disk before changed values are written to disk</h4></a><a href=#issues-with-undo-logging><h4 id=issues-with-undo-logging><span class=hanchor arialabel=Anchor># </span>Issues with Undo Logging</h4></a><ul><li>If a transaction <strong><strong>T</strong></strong> commits, then its <strong>**&lt; commit T > **</strong> log record must be written to disk only after all database items changed by <strong><strong>T</strong></strong> have been written to disk</li><li>Potentially causes more disk i/o operations</li></ul><a href=#example-1><h4 id=example-1><span class=hanchor arialabel=Anchor># </span>Example</h4></a><ul><li><img src=https://remnote-user-data.s3.amazonaws.com/6T2yqOOpbuxOxcmHvNQA4KwwHFzox1DFwPr6mWqxlxn7nglPR6X3Cw7BqqR0lS8bgyPHsGKcXVnwVE5kfP1lJHaYQ4ddKchNX_tOLCVPkf4hkLYC1ZSoVH5zllXjF1MP.png width=400 alt=|400></li></ul><a href=#recovery-with-redo-logging><h4 id=recovery-with-redo-logging><span class=hanchor arialabel=Anchor># </span>Recovery with Redo Logging</h4></a><ul><li><img src=https://remnote-user-data.s3.amazonaws.com/fs7clV_MO74AHricv-qGsBEDIh8oYPFkQlD1B-w_cweGv_pmbj75u0uj0qMWqGKw1b-q_olDZvNmDOtBAVLT8v2pjULU-iLlPEVefonRoKA5hM4XFxhSSaPto7UWb3mQ.png width=400 alt=|400></li><li></li><li>Recovery with Checkpointed Redo Logging<ul><li>Two cases for recovery depending on latest checkpoint log record<ul><li><strong>**&lt; end ckpt > **</strong> appears latest <strong>** **</strong><ul><li><img src=https://remnote-user-data.s3.amazonaws.com/V3H8bnSxCjPlKB5zt1gPeEuvgl14t2u6gI1vp_U1T_YvVFjxjlds_PjULiTLqoECZruvVUAaAUWSElSL9elhC3cI71da_lpQsMC3V9h-Osrb8p05KKgKfMPJi8A20pCD.png width=400 alt=|400></li><li>Ignore every value written by transactions that committed before the corresponding <strong><strong>&lt; start ckpt () ></strong></strong> has been written to disk</li><li>Any transaction named in the checkpoint start, or which has started since, may have changes that have not been written to disk (even if the transaction has committed)</li></ul></li><li><strong><strong>&lt; start ckpt (</strong></strong> T_1&mldr;T_n <strong><strong>) ></strong></strong>#<ul><li>Can&rsquo;t tell whether committed transactions to this checkpoint had their changes written to disk</li><li>Search back to the previous <strong><strong>&lt; end ckpt ></strong></strong> , find its corresponding <strong><strong>&lt; start ckpt () ></strong></strong> and treat as [&lt; end ckpt > appears latest ](Advanced Databases/Week 6/Logging and Recovery/Logging/Redo Logging/(Non-quiescent) Checkpointing with Redo Logging/Recovery with Checkpointed Redo Logging/Two cases for recovery depending on latest checkpoint log record/_ end ckpt _ appears latest.md)</li><li><img src=https://remnote-user-data.s3.amazonaws.com/gp1GVzxUqwGPUEjGvRctvKao1pYxk7KovkN7Es_iV2aX6P-nmehnFdqG1KYQG1fP0P0chb2oN7gXK3fnFW3HOKjZ-jlFbAGLQ0Osg7MuDMut_zFZCgwnZhZlj5md3r_6.png width=400 alt=|400></li></ul></li></ul></li></ul></li><li><img src=https://remnote-user-data.s3.amazonaws.com/TlpVrAi0FZXVbWfLBJUrx3E3GK2KXfymqlbGzh8NjP3pGHe-whpndT9NmK4V0d3qDFnJrzdcWHPRYsTzGQsQk3vxVdi9bhrS0WSeMo1LXIozwKHqF8lZiS-6oZimOzNa.png width=400 alt=|400></li><li>Write to disk all database items that have been written to buffers but not yet to disk, by transactions that have already committed</li><li>Write log record <strong><strong>&lt; end ckpt ></strong></strong> and flush log</li><li>Write log record <strong><strong>&lt; start ckpt (</strong></strong> T_1&mldr;T_n <strong><strong>) ></strong></strong> , where T_1&mldr;T_n are uncommitted, and flush log</li></ul><a href=#redo-logging-rule><h4 id=redo-logging-rule><span class=hanchor arialabel=Anchor># </span>Redo Logging Rule</h4></a><ul><li>R1: Before modifying a database item <strong><strong>X</strong></strong> on disk, all log records related to the modification ( <strong><strong>&lt; T, X, new ></strong></strong> , <strong><strong>&lt; commit T ></strong></strong> ) must be written to disk</li></ul><a href=#ignore-incomplete-transactions-repeat-changes-made-by-committed-transactions><h4 id=ignore-incomplete-transactions-repeat-changes-made-by-committed-transactions><span class=hanchor arialabel=Anchor># </span>Ignore incomplete transactions, repeat changes made by committed transactions</h4></a><a href=#if-no--__-commit-t-__--record-has-been-written-no-changes-by--__t__--have-been-written-to-disk><h4 id=if-no--__-commit-t-__--record-has-been-written-no-changes-by--__t__--have-been-written-to-disk><span class=hanchor arialabel=Anchor># </span>If no <strong><strong>&lt; commit T ></strong></strong> record has been written, no changes by <strong><strong>T</strong></strong> have been written to disk</h4></a><a href=#new-record-type-to-record-changes><h4 id=new-record-type-to-record-changes><span class=hanchor arialabel=Anchor># </span>New record type to record changes</h4></a><ul><li><strong><strong>&lt; T, X, new ></strong></strong> →Transaction <strong><strong>T</strong></strong> has changed database item <strong><strong>X</strong></strong> to a new value</li></ul><a href=#undoredo-logging><h3 id=undoredo-logging><span class=hanchor arialabel=Anchor># </span>Undo/Redo Logging</h3></a><a href=#undoredo-logging-rules><h4 id=undoredo-logging-rules><span class=hanchor arialabel=Anchor># </span>Undo/Redo Logging Rules</h4></a><ul><li>UR2: A <strong><strong>&lt; commit T ></strong></strong> record must be flushed to disk as soon as it is written to log</li><li>UR1: Before transaction <strong><strong>T</strong></strong> modifies any database item <strong><strong>X</strong></strong> on disk, the update record <strong><strong>&lt; T, X, old, new ></strong></strong> must be written to disk</li></ul><a href=#recovery-with-undoredo-logging><h4 id=recovery-with-undoredo-logging><span class=hanchor arialabel=Anchor># </span>Recovery with Undo/Redo Logging→</h4></a><ul><li>Redo all committed transactions from oldest to newest</li><li>Undo all incomplete transactions from newest to oldest</li></ul><h4 id=400httpsremnote-user-datas3amazonawscomlww3xo0vghmovnhqhgqk4grjcfchtwwksqjbab6-kkek0ug4kqxdvrq9ncsgyaehm_tg7jl6gei2tgs608glnzykor9jrdkelvjdwew6n3msiou48stibnrgb2lrfz6jpng><img src=https://remnote-user-data.s3.amazonaws.com/lww3Xo0vgHMOvNhQhGqk4GRjCFChtWWksQJBAb6-KKeK0ug4kQxDvrQ9NcSGYAEHm_tg7Jl6geI2tgs608GlNZyKoR9JRdkELVjDwew6N3msiOu48StibNRgB2lrFz6J.png width=400 alt=|400></h4><a href=#checkpointing-with-undoredo-logging><h4 id=checkpointing-with-undoredo-logging><span class=hanchor arialabel=Anchor># </span>Checkpointing with Undo/Redo Logging→</h4></a><ul><li>Write <strong><strong>&lt; end ckpt ></strong></strong> to log and flush log</li><li>Write to disk all dirty buffers (i.e. those with one or more changed database items, not just those from committed transactions)</li><li>Write <strong><strong>&lt; start ckpt (</strong></strong> T_1&mldr;T_n <strong><strong>) ></strong></strong> to log and flush log</li></ul><a href=#introduces-a-new-record-type-to-record-changes><h4 id=introduces-a-new-record-type-to-record-changes><span class=hanchor arialabel=Anchor># </span>Introduces a new record type to record changes</h4></a><ul><li><strong><strong>&lt; T, X, old, new ></strong></strong> →Transaction <strong><strong>T</strong></strong> has changed database item <strong><strong>X</strong></strong> from an old value to a new value</li></ul><a href=#aims-to-address-issues-with-both-undo-and-redo-logging><h4 id=aims-to-address-issues-with-both-undo-and-redo-logging><span class=hanchor arialabel=Anchor># </span>Aims to address issues with both undo and redo logging</h4></a><ul><li>Undo logging may increase <strong>number of disk i/o operations</strong></li><li>Redo logging requires that <strong>all modified blocks be kept in buffers until the transaction commits and the logs flushed</strong></li></ul></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script async src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://ik1g19.github.io/UoS-Notes/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by Isaac Klugman using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://ik1g19.github.io/UoS-Notes/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>GitHub</a></li></ul></footer></div></div></body></html>